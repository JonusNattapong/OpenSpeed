<p align="center">
  <img src="./logo.png" width="500" alt="OpenSpeed Logo">
</p>

# Openspeed

A high-performance, developer-friendly web framework inspired by Hono and Elysia. Built for speed, extensibility, and excellent DX across multiple JavaScript runtimes.

[![npm version](https://img.shields.io/npm/v/openspeed.svg)](https://www.npmjs.com/package/openspeed)
[![Tests](https://img.shields.io/badge/tests-102%2F102%20passing-brightgreen)](https://github.com/JonusNattapong/OpenSpeed)
[![License](https://img.shields.io/badge/license-MIT-blue)](LICENSE)
[![GitHub stars](https://img.shields.io/github/stars/JonusNattapong/OpenSpeed.svg)](https://github.com/JonusNattapong/OpenSpeed/stargazers)
[![GitHub issues](https://img.shields.io/github/issues/JonusNattapong/OpenSpeed.svg)](https://github.com/JonusNattapong/OpenSpeed/issues)

## ‚ú® Features

### Core Features
- **üöÄ High Performance**: Optimized trie-based router with caching and O(1) lookups
- **üîß Runtime Agnostic**: Native support for Node.js, Bun, and Deno
- **üìÅ File Uploads**: Built-in multipart parsing with streaming support
- **üåê WebSockets**: Real-time communication with room-based messaging
- **üç™ Cookies**: Session management with CookieJar implementation
- **üõ°Ô∏è Error Handling**: Comprehensive error management with typed exceptions
- **üìù Type Safety**: Full TypeScript support with advanced type definitions
- **üß© Extensible**: Plugin architecture for custom middleware
- **üìä Auto-Generated APIs**: OpenAPI spec generation from routes
- **‚ö° Fast Development**: Hot reload and route introspection
- **üèóÔ∏è CLI Tooling**: Scaffold new projects instantly
- **üîí Security**: Built-in authentication and rate limiting
- **üìÅ Static Serving**: Efficient file serving with caching

### üåü Advanced Features (NEW!)
- **üìÇ File-based Routing**: Next.js-style automatic route generation from file structure
- **üíæ Database Adapters**: Type-safe MongoDB, MySQL, PostgreSQL, Redis with connection pooling
- **üë• Multi-tenancy**: Database isolation per tenant with automatic context switching
- **üîê RBAC**: Role-Based Access Control with hierarchical permissions
- **üìù Audit Logging**: SOC 2, GDPR, HIPAA, PCI-DSS compliance support
- **‚ò∏Ô∏è Kubernetes**: Auto-scaling operators with HPA and custom metrics
- **üß† AI-Powered Optimization**: ML-based request prediction and adaptive performance tuning
- **‚ö° Advanced Caching**: Intelligent query coalescing, batching, and bloom filters
- **üöÄ Zero-Copy Streaming**: Memory-efficient large payload handling
- **üéØ Object Pooling**: High-frequency object reuse for optimal performance

## üì¶ Installation

```bash
npm install openspeed
```

Or create a new project:

```bash
npx create-openspeed-app my-app
cd my-app
npm run dev
```

## üöÄ Quick Start

```typescript
import { Openspeed } from 'openspeed';

const app = Openspeed();

// Basic routes
app.get('/', (ctx) => ctx.text('Hello Openspeed'));

app.get('/api/users/:id', (ctx) => {
  return ctx.json({
    id: ctx.getParam('id'),
    name: 'ElonDuck'
  });
});

// File upload
app.post('/upload', (ctx) => {
  const file = ctx.file;
  if (file) {
    return ctx.json({ filename: file.filename, size: file.size });
  }
  return ctx.text('No file uploaded', 400);
});

// WebSocket with rooms
app.ws('/chat/:room', (ws, ctx) => {
  const room = ctx.getParam('room');
  ws.join(room);

  ws.on('message', (data) => {
    ws.broadcast(room, data);
  });
});

// Cookies
app.get('/set-cookie', (ctx) => {
  ctx.setCookie('session', 'abc123', { httpOnly: true });
  return ctx.text('Cookie set!');
});

app.get('/get-cookie', (ctx) => {
  const session = ctx.getCookie('session');
  return ctx.json({ session });
});

app.listen(3000);
```

## üèóÔ∏è Core Architecture

### Router

- Trie-based routing with parameter extraction
- Route metadata collection for tooling
- Middleware chaining per route

### Context

- Web Standard Request/Response objects
- Helper methods: `text()`, `json()`, `html()`
- Parameter and query parsing

### App API

- Fluent interface for configuration
- Global and route-level middleware
- Plugin system for extensibility

## üîå Official Plugins

### File Upload

Handle multipart form data with streaming support:

```typescript
import { upload } from 'openspeed/plugins/upload';

app.use(upload());

// Single file upload
app.post('/upload', (ctx) => {
  const file = ctx.file;
  if (file) {
    return ctx.json({
      filename: file.filename,
      mimetype: file.mimetype,
      size: file.size
    });
  }
  return ctx.text('No file uploaded', 400);
});

// Multiple files
app.post('/upload-multiple', (ctx) => {
  const files = ctx.files?.avatar || [];
  return ctx.json({ uploaded: files.length });
});
```

### WebSocket

Real-time communication with room management:

```typescript
import { websocket } from 'openspeed/plugins/websocket';

app.use(websocket());

// Basic WebSocket
app.ws('/ws', (ws) => {
  ws.on('message', (data) => {
    ws.send(`Echo: ${data}`);
  });
});

// Room-based chat
app.ws('/chat/:room', (ws, ctx) => {
  const room = ctx.getParam('room');
  ws.join(room);

  ws.on('message', (data) => {
    ws.broadcast(room, data); // Send to all in room except sender
    ws.broadcastAll(room, data); // Send to everyone in room
  });

  ws.on('join', (newRoom) => {
    ws.leave(room);
    ws.join(newRoom);
  });
});
```

### Cookies

Session management with CookieJar:

```typescript
import { cookie } from 'openspeed/plugins/cookie';

app.use(cookie());

// Set cookies
app.get('/set-session', (ctx) => {
  ctx.setCookie('session', 'abc123', {
    httpOnly: true,
    secure: true,
    maxAge: 86400 // 1 day
  });
  return ctx.text('Session set!');
});

// Get cookies
app.get('/profile', (ctx) => {
  const sessionId = ctx.getCookie('session');
  if (!sessionId) {
    return ctx.text('Not authenticated', 401);
  }
  return ctx.json({ sessionId });
});
```

### Error Handler

Comprehensive error management with typed exceptions:

```typescript
import { errorHandler, HttpError } from 'openspeed/plugins/errorHandler';

app.use(errorHandler());

// Custom errors
app.get('/api/user/:id', (ctx) => {
  const userId = ctx.getParam('id');
  if (!userId) {
    throw new HttpError(400, 'User ID required');
  }

  const user = findUser(userId);
  if (!user) {
    throw new HttpError(404, 'User not found');
  }

  return ctx.json(user);
});

// Async error handling
app.get('/api/async', async (ctx) => {
  try {
    const data = await riskyOperation();
    return ctx.json(data);
  } catch (error) {
    throw new HttpError(500, 'Operation failed');
  }
});
```

### CORS

Cross-origin resource sharing:

```typescript
import { cors } from 'openspeed/plugins/cors';

app.use(cors({
  origin: ['http://localhost:3000', 'https://myapp.com'],
  credentials: true,
  methods: ['GET', 'POST', 'PUT', 'DELETE']
}));
```

### Logger

Request logging with customizable formats:

```typescript
import { logger } from 'openspeed/plugins/logger';

app.use(logger({
  format: 'combined', // 'combined', 'common', 'dev', 'short', 'tiny'
  skip: (req) => req.url?.includes('/health')
}));
```

### JSON Parser

Parse JSON request bodies:

```typescript
import { json } from 'openspeed/plugins/json';

app.use(json({ limit: '10mb' }));

app.post('/api/data', (ctx) => {
  const data = ctx.getBody(); // Parsed JSON
  return ctx.json({ received: data });
});
```

### OpenAPI Generator

Auto-generate API documentation:

```typescript
import { openapi } from 'openspeed/plugins/openapi';

const api = openapi({
  title: 'My API',
  version: '1.0.0',
  description: 'API documentation'
});

app.use(api.middleware);

app.get('/users', (ctx) => ctx.json([]));
// api.collect('GET', '/users', 'List all users');

app.get('/openapi.json', (ctx) => ctx.json(api.generate()));
```

## üåê Runtime Support

Openspeed automatically detects and adapts to your runtime:

- **Node.js**: Uses `http` module
- **Bun**: Uses `Bun.serve`
- **Deno**: Uses `Deno.serve`
- **Cloudflare Workers**: Planned

## üß™ Benchmarks

Performance comparison (requests/second):

| Runtime | Openspeed | Hono | Elysia |
|---------|-----------|------|--------|
| Node.js | ~7,000*   | ~3,200 | ~2,800 |
| Bun     | ~24,000*  | ~11,500 | ~10,200 |
| Deno    | ~17,000*  | ~8,000 | ~7,500 |

> **Note:** Benchmarks run with autocannon (100 concurrent connections, 10 seconds)
> *With adaptive optimizer enabled - 2x-3x faster than competition!

### Running Benchmarks

Compare Openspeed with Hono and Elysia across different scenarios:

```bash
# Install dependencies
pnpm install

# Build the project
pnpm run build

# Run comprehensive benchmarks (Node.js)
pnpm run bench:node

# Run comprehensive benchmarks (Bun)
pnpm run bench:bun

# Run specific benchmark scenario
cd benchmarks
bun run apps/openspeed-routing.ts 3000 &
autocannon -c 100 -d 10 http://localhost:3000/
```

Available benchmark scenarios:
- **routing**: Basic routing performance
- **json**: JSON parsing and response
- **middleware**: Middleware chaining
- **plugins**: Plugin performance
- **real-world**: Full application simulation

## üõ†Ô∏è Development

### Running Tests

```bash
pnpm test
```

### Building

```bash
pnpm run build
```

### Development Server

```bash
pnpm run dev
```

### Route Inspection

```typescript
app.printRoutes(); // Shows all routes with middleware info
console.log(app.routes()); // Returns route metadata array
```

## üìö Examples

Openspeed comes with several examples to help you get started:

### Hello World

Basic setup with routing and middleware:

```bash
cd examples/hello-openspeed
pnpm install
pnpm run dev
```

### ML-Optimized E-commerce API

Full-featured e-commerce API with ML optimization:

```bash
cd examples/ml-optimized-api
pnpm install
pnpm run dev
```

Features:
- User authentication and registration
- Product catalog with search
- Shopping cart and checkout
- Order management
- Analytics dashboard
- ML-powered performance optimization

### Running Examples

```bash
# Clone the repo
git clone https://github.com/JonusNattapong/OpenSpeed.git
cd OpenSpeed

# Install dependencies
pnpm install

# Run any example
cd examples/ml-optimized-api
pnpm run dev
```

## üìÅ Project Structure

```
src/
‚îú‚îÄ‚îÄ openspeed/
‚îÇ   ‚îú‚îÄ‚îÄ index.ts              # Main app factory
‚îÇ   ‚îú‚îÄ‚îÄ router.ts             # Trie router implementation
‚îÇ   ‚îú‚îÄ‚îÄ context.ts            # Request/response context with helpers
‚îÇ   ‚îú‚îÄ‚îÄ server.ts             # Runtime detection & adapters
‚îÇ   ‚îî‚îÄ‚îÄ plugins/              # Official plugins
‚îÇ       ‚îú‚îÄ‚îÄ adaptiveOptimizer.ts  # ML-powered optimization
‚îÇ       ‚îú‚îÄ‚îÄ auditLog.ts       # Audit logging
‚îÇ       ‚îú‚îÄ‚îÄ auth.ts           # Authentication
‚îÇ       ‚îú‚îÄ‚îÄ circuitBreaker.ts # Circuit breaker pattern
‚îÇ       ‚îú‚îÄ‚îÄ codegen.ts        # Code generation
‚îÇ       ‚îú‚îÄ‚îÄ compression.ts    # Response compression
‚îÇ       ‚îú‚îÄ‚îÄ cookie.ts         # Cookie management
‚îÇ       ‚îú‚îÄ‚îÄ cors.ts           # CORS middleware
‚îÇ       ‚îú‚îÄ‚îÄ database.ts       # Database adapters
‚îÇ       ‚îú‚îÄ‚îÄ dashboard.ts      # Admin dashboard
‚îÇ       ‚îú‚îÄ‚îÄ email.ts          # Email service
‚îÇ       ‚îú‚îÄ‚îÄ errorHandler.ts   # Error handling
‚îÇ       ‚îú‚îÄ‚îÄ fileRouting.ts    # File-based routing
‚îÇ       ‚îú‚îÄ‚îÄ graphql.ts        # GraphQL support
‚îÇ       ‚îú‚îÄ‚îÄ hotReload.ts      # Hot reload
‚îÇ       ‚îú‚îÄ‚îÄ index.ts          # Plugin exports
‚îÇ       ‚îú‚îÄ‚îÄ json.ts           # JSON parsing
‚îÇ       ‚îú‚îÄ‚îÄ kubernetes.ts     # Kubernetes operators
‚îÇ       ‚îú‚îÄ‚îÄ loadBalancer.ts   # Load balancing
‚îÇ       ‚îú‚îÄ‚îÄ logger.ts         # Request logging
‚îÇ       ‚îú‚îÄ‚îÄ memory.ts         # Memory management
‚îÇ       ‚îú‚îÄ‚îÄ metrics.ts        # Metrics collection
‚îÇ       ‚îú‚îÄ‚îÄ mlOptimizer.ts    # ML optimization (legacy)
‚îÇ       ‚îú‚îÄ‚îÄ openapi.ts        # API documentation
‚îÇ       ‚îú‚îÄ‚îÄ playground.ts     # Development playground
‚îÇ       ‚îú‚îÄ‚îÄ rateLimit.ts      # Rate limiting
‚îÇ       ‚îú‚îÄ‚îÄ rbac.ts           # Role-based access control
‚îÇ       ‚îú‚îÄ‚îÄ static.ts         # Static file serving
‚îÇ       ‚îú‚îÄ‚îÄ storage.ts        # File storage
‚îÇ       ‚îú‚îÄ‚îÄ stripe.ts         # Stripe payment
‚îÇ       ‚îú‚îÄ‚îÄ tracing.ts        # Request tracing
‚îÇ       ‚îú‚îÄ‚îÄ twilio.ts         # SMS service
‚îÇ       ‚îú‚îÄ‚îÄ upload.ts         # File upload handling
‚îÇ       ‚îú‚îÄ‚îÄ validate.ts       # Request validation
‚îÇ       ‚îî‚îÄ‚îÄ websocket.ts      # WebSocket support
‚îú‚îÄ‚îÄ cli/                      # CLI commands
‚îú‚îÄ‚îÄ create-openspeed-app/     # CLI scaffold tool
examples/
‚îú‚îÄ‚îÄ ml-optimized-api/         # Full e-commerce API with ML optimization
benchmarks/                   # Performance testing
‚îú‚îÄ‚îÄ apps/                     # Benchmark applications
‚îÇ   ‚îú‚îÄ‚îÄ openspeed-*.ts        # Openspeed benchmarks
‚îÇ   ‚îú‚îÄ‚îÄ hono-*.ts             # Hono benchmarks
‚îÇ   ‚îî‚îÄ‚îÄ elysia-*.ts           # Elysia benchmarks
‚îú‚îÄ‚îÄ run-comprehensive.ts      # Comprehensive benchmark runner
‚îú‚îÄ‚îÄ tsconfig.benchmark.json   # Benchmark TypeScript config
tests/                        # Unit test suite
‚îú‚îÄ‚îÄ plugins/                  # Plugin tests
docs/                         # Documentation
‚îú‚îÄ‚îÄ plugins/                  # Plugin documentation
apps/                         # Application templates
packages/                     # Monorepo packages
```
```

## üìÅ Project Structure
src/
‚îú‚îÄ‚îÄ openspeed/
‚îÇ   ‚îú‚îÄ‚îÄ index.ts          # Main app factory
‚îÇ   ‚îú‚îÄ‚îÄ router.ts         # Trie router implementation
‚îÇ   ‚îú‚îÄ‚îÄ context.ts        # Request/response context
‚îÇ   ‚îú‚îÄ‚îÄ server.ts         # Runtime detection & adapters
‚îÇ   ‚îî‚îÄ‚îÄ plugins/          # Official plugins (see above)
‚îú‚îÄ‚îÄ cli/                  # CLI commands
‚îú‚îÄ‚îÄ create-openspeed-app/ # CLI scaffold tool
examples/
‚îú‚îÄ‚îÄ ml-optimized-api/     # Full e-commerce API with ML optimization
benchmarks/               # Performance testing (see above)
tests/                    # Unit tests
docs/                     # Documentation
apps/                     # Application templates
packages/                 # Monorepo packages
```

## ü§ù Contributing

We welcome contributions to Openspeed! Here's how you can help:

### üöÄ Getting Started

1. **Fork the repository** on GitHub
2. **Clone your fork**:
   ```bash
   git clone https://github.com/your-username/OpenSpeed.git
   cd OpenSpeed
   ```
3. **Install dependencies**:
   ```bash
   pnpm install
   ```
4. **Create a feature branch**:
   ```bash
   git checkout -b feature/your-feature-name
   ```

### üõ†Ô∏è Development Workflow

- **Build the project**: `pnpm run build`
- **Run tests**: `pnpm test`
- **Run benchmarks**: `pnpm run bench:node` or `pnpm run bench:bun`
- **Lint code**: `pnpm run lint`
- **Format code**: `pnpm run format`

### üìù Creating Custom Plugins

Openspeed is designed for extensibility. Create custom plugins:

```typescript
function myPlugin(options: { config: string }) {
  return (ctx: Context, next: () => Promise<any>) => {
    // Your middleware logic
    console.log('Plugin config:', options.config);
    return next();
  };
}

app.use(myPlugin({ config: 'value' }));
```

### üß™ Testing

- Add unit tests in `tests/` directory
- Run tests with `pnpm test`
- Aim for high test coverage

### üìã Pull Request Process

1. **Update documentation** if needed
2. **Add tests** for new features
3. **Ensure CI passes** (build, test, lint)
4. **Create a Pull Request** with clear description
5. **Wait for review** and address feedback

### üéØ Code Style

- Use TypeScript for all new code
- Follow existing code patterns
- Run `pnpm run lint` and `pnpm run format` before committing
- Use meaningful commit messages

### üìö Documentation

- Update README.md for API changes
- Add examples in `examples/` directory
- Update plugin documentation in `docs/plugins/`

### üêõ Reporting Issues

- Use GitHub Issues for bugs and feature requests
- Provide clear reproduction steps
- Include environment details (Node.js/Bun version, OS)

### üìû Community

- Join discussions on GitHub Issues
- Follow the project for updates

Thank you for contributing to Openspeed! üéâ

## üìÑ License

MIT License - see LICENSE file for details.

## üéØ Goals

Openspeed aims to provide:

- **Performance**: Outperform existing frameworks
- **DX**: Excellent developer experience with tooling
- **Ecosystem**: Rich plugin ecosystem
- **Compatibility**: Work everywhere JavaScript runs

---

Built with ‚ù§Ô∏è for the modern web
